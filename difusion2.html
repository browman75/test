<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ°£é«”åˆ†å­æ“´æ•£æ¨¡æ“¬å™¨</title>
<style>
  body { text-align:center; font-family:sans-serif; background:#eef9ff; }
  canvas { border:1px solid #333; background:white; margin-top:10px; }
  .controls { margin-top:10px; }
  label { margin:0 8px; }
  #chartContainer { width:800px; margin:15px auto; }
</style>
</head>
<body>
<h2>ğŸŒ¬ï¸ æ°£é«”åˆ†å­æ“´æ•£èˆ‡å¤–åŠ›æ¨¡æ“¬å™¨</h2>
<p>è§€å¯Ÿæ°£é«”åˆ†å­å¸ƒæœ—é‹å‹•ä¸‹çš„æ“´æ•£ç¾è±¡ï¼Œä¸¦æ¯”è¼ƒå¤–åŠ›ï¼ˆé¢¨ï¼‰å°æ“´æ•£çš„å½±éŸ¿ã€‚</p>

<div class="controls">
  <label>æº«åº¦:
    <input type="range" id="temp" min="1" max="10" value="5">
  </label>
  <label>åˆ†å­å¤§å°:
    <input type="range" id="size" min="1" max="10" value="3">
  </label>
  <label>
    <input type="checkbox" id="windToggle"> é–‹å•Ÿé¢¨
  </label>
  <label>é¢¨é€Ÿ:
    <input type="range" id="wind" min="0" max="5" step="0.5" value="0" disabled>
  </label>
  <button id="reset">é‡ç½®</button>
</div>

<canvas id="simCanvas" width="800" height="400"></canvas>
<p id="stats"></p>

<div id="chartContainer">
  <canvas id="chartCanvas" width="800" height="200"></canvas>
</div>

<!-- å¼•å…¥ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// ====== æ¨¡æ“¬è¨­å®š ======
const simCanvas = document.getElementById("simCanvas");
const ctx = simCanvas.getContext("2d");
const tempSlider = document.getElementById("temp");
const sizeSlider = document.getElementById("size");
const windSlider = document.getElementById("wind");
const windToggle = document.getElementById("windToggle");
const stats = document.getElementById("stats");
const resetBtn = document.getElementById("reset");

let particles = [];
const numParticles = 150;
let frameCount = 0;

// ====== åˆå§‹åŒ–ç²’å­ ======
function resetParticles() {
  particles = [];
  for (let i = 0; i < numParticles; i++) {
    particles.push({
      x: Math.random() * simCanvas.width / 2, // å·¦å´åˆå§‹
      y: Math.random() * simCanvas.height,
      vx: (Math.random() - 0.5) * 2,
      vy: (Math.random() - 0.5) * 2,
      color: "rgba(0,150,255,0.7)"
    });
  }
  frameCount = 0;
  chart.data.labels = [];
  chart.data.datasets[0].data = [];
  chart.data.datasets[1].data = [];
  chart.update();
}
resetParticles();

// ====== å»ºç«‹åœ–è¡¨ ======
const chartCtx = document.getElementById('chartCanvas').getContext('2d');
const chart = new Chart(chartCtx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [
      { label: 'å·¦å´åˆ†å­æ¯”ä¾‹ (%)', borderColor: 'blue', data: [], fill:false },
      { label: 'å³å´åˆ†å­æ¯”ä¾‹ (%)', borderColor: 'red', data: [], fill:false }
    ]
  },
  options: {
    animation: false,
    scales: {
      y: { min: 0, max: 100, title: { display: true, text: 'æ¯”ä¾‹ (%)' } },
      x: { title: { display: true, text: 'æ™‚é–“ (frame)' } }
    },
    plugins: { legend: { position: 'bottom' } }
  }
});

// ====== å‹•ç•«æ›´æ–° ======
function update() {
  const temp = parseFloat(tempSlider.value);
  const size = parseFloat(sizeSlider.value);
  const windEnabled = windToggle.checked;
  const wind = windEnabled ? parseFloat(windSlider.value) : 0;

  // é¢¨é€Ÿæ§åˆ¶
  windSlider.disabled = !windEnabled;
  if (!windEnabled) windSlider.value = 0;

  ctx.clearRect(0, 0, simCanvas.width, simCanvas.height);

  let leftCount = 0;
  let rightCount = 0;

  for (let p of particles) {
    // æº«åº¦ â†’ éš¨æ©Ÿé‹å‹•å¹…åº¦
    p.vx += (Math.random() - 0.5) * 0.3 * temp;
    p.vy += (Math.random() - 0.5) * 0.3 * temp;

    // å¤–åŠ› â†’ é¢¨
    p.vx += wind * 0.1;

    // åˆ†å­å¤§å° â†’ æ…£æ€§é˜»åŠ›
    p.vx *= (1 - size * 0.03);
    p.vy *= (1 - size * 0.03);

    // æ›´æ–°ä½ç½®
    p.x += p.vx;
    p.y += p.vy;

    // é‚Šç•Œåå½ˆ
    if (p.x < 0) { p.x = 0; p.vx *= -1; }
    if (p.x > simCanvas.width) { p.x = simCanvas.width; p.vx *= -1; }
    if (p.y < 0) { p.y = 0; p.vy *= -1; }
    if (p.y > simCanvas.height) { p.y = simCanvas.height; p.vy *= -1; }

    // è¨ˆç®—å·¦å³åˆ†å¸ƒ
    if (p.x < simCanvas.width / 2) leftCount++;
    else rightCount++;

    // ç•«ç²’å­
    ctx.beginPath();
    ctx.arc(p.x, p.y, size, 0, Math.PI * 2);
    ctx.fillStyle = p.color;
    ctx.fill();
  }

  // é¡¯ç¤ºè³‡è¨Š
  stats.textContent = `å·¦å´: ${leftCount} é¡† | å³å´: ${rightCount} é¡† | é¢¨é€Ÿ: ${wind.toFixed(1)} (æ–¹å‘ï¼šâ†’)`;

  // æ›´æ–°åœ–è¡¨ï¼ˆæ¯ 5 å¹€ï¼‰
  frameCount++;
  if (frameCount % 5 === 0) {
    const leftPercent = (leftCount / numParticles * 100).toFixed(1);
    const rightPercent = (rightCount / numParticles * 100).toFixed(1);
    chart.data.labels.push(frameCount);
    chart.data.datasets[0].data.push(leftPercent);
    chart.data.datasets[1].data.push(rightPercent);
    if (chart.data.labels.length > 80) { // ä¿ç•™æœ€è¿‘ 80 ç­†è³‡æ–™
      chart.data.labels.shift();
      chart.data.datasets[0].data.shift();
      chart.data.datasets[1].data.shift();
    }
    chart.update();
  }

  requestAnimationFrame(update);
}

resetBtn.onclick = resetParticles;
update();
</script>
</body>
</html>
